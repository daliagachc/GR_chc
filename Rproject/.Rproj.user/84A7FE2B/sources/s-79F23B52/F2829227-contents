temp_plot_grid_extended=function(plotlist,relative_heights,relative_widths){
  
  #a helping function that slightly adjusts get_legend so that it doesnt break 
  #when no legend exists.
  get_legend_if_exists= function (plot) 
  {
    grobs <- plot_to_gtable(plot)$grobs
    legendIndex <- which(sapply(grobs, function(x) x$name) == 
                           "guide-box")
    if (length(legendIndex) == 1) {
      legend <- grobs[[legendIndex]]
    }
    else {#return an empty object if no legend
      legend=ggplot()
    }
  }
  
  #decomposing ggplots into plots and legends
  plots=list()
  legends=list()
  for (i in 1:length(plotlist)){
    plots[[i]]=plotlist[[i]]+theme(legend.position="none")
    legends[[i]]=get_legend_if_exists(plotlist[[i]])
  }
  
  plots_gridded=plot_grid(plotlist=plots,align="hv",ncol=1,rel_heights=relative_heights)
  legends_gridded=plot_grid(plotlist=legends,ncol=1,rel_heights=relative_heights)

  outplot=plot_grid(plots_gridded,legends_gridded,rel_widths=relative_widths)
  return(outplot)
} 
